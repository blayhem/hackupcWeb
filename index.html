<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
	<title>HackUPC demo</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link rel="stylesheet" href="css/style.css"/>
	<link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.15/themes/css/cartodb.css" />
	<style></style>
</head>

<body>
  <div id='container'></div>
	<script src="http://libs.cartocdn.com/cartodb.js/v3/3.15/cartodb.js"></script>
	<script src="build/vendor.bundle.js"></script>
  <script src='build/app.bundle.js'></script>
	<script>
    let cartoMap;
		window.onload = () => {
      
			//cartodb.createVis('map', 
			//'https://marioloko.carto.com/api/v2/viz/a5a075c2-8d8e-11e6-8b4c-0e05a8b3e3d7/viz.json', {
      //'http://documentation.carto.com/api/v2/viz/2b13c956-e7c1-11e2-806b-5404a6a683d5/viz.json', {
      cartoMap = new L.map('map',{
          center: [40, -3],
          zoom: 5,
					shareable: false,
					title: false,
					description: true,
					search: false,
					tiles_loader: true,
          scrollwheel:true,
          legends:false
			})
			// .done(function(vis, layers) {
      //   cartoMap = vis.getNativeMap();
			// 	// // layer 0 is the base layer, layer 1 is cartodb layer
			// 	// // setInteraction is disabled by default
			// 	// layers[1].setInteraction(true);
			// 	// layers[1].on('featureOver', function(e, latlng, pos, data) {
			// 	// 	 //cartodb.log.log(e, latlng, pos, data);
			// 	// });
			// 	// // you can get the native map to work with it
			// 	// var map = vis.getNativeMap();
			// 	// // now, perform any operations you need
			// 	// // map.setZoom(3);
			// 	// // map.panTo([50.5, 30.5]);
			// })
			// .error(function(err) {
			// 	console.log(err);
			// });
      console.log(cartoMap);
      let layerURL = 'https://marioloko.carto.com/api/v2/viz/a5a075c2-8d8e-11e6-8b4c-0e05a8b3e3d7/viz.json';
      let query = {
        sql: "SELECT * FROM data_export_09_2016 WHERE extract(dow FROM date) = 0 AND EXTRACT(hour FROM date) = 0"
      }
      
      cartodb.createLayer(cartoMap, layerURL)
      .addTo(cartoMap)
      .on('done', function(layer){
        console.log(layer);
        let sublayer = layer.getSubLayer(0);
        sublayer.set(query);
        sublayers.push(sublayer);
      });
		}

		cartoQuery();
		document.getElementById("weekday").addEventListener("change", cartoQuery);
		document.getElementById("hour").addEventListener("change", cartoQuery);

		function cartoQuery(){
      console.log(cartoMap);
			let d = document.querySelector('#weekday').value;
			console.log(d);
			let h = document.querySelector('#hour').value;
			console.log(h);
			
			let sql = new cartodb.SQL({ user: 'marioloko' });
      sql.execute("SELECT * FROM data_export_09_2016 WHERE extract(dow FROM date) = 0 AND EXTRACT(hour FROM date) = 0", { day:d, hour:h })
		.done(function(vis, layers, data) {
      
      
		})
		.error(function(errors) {
			// errors contains a list of errors
			console.log("errors:" + errors);
		})
		}
	</script>
</body>
</html>
